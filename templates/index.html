<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASMuvera - Multi-Vector Search Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        .result-card:hover { transform: translateY(-2px); transition: transform 0.2s; }
        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" x-data="searchApp()">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-search text-blue-600 text-2xl"></i>
                        <h1 class="text-2xl font-bold text-gray-900">ASMuvera</h1>
                    </div>
                    <span class="text-sm text-gray-500 hidden sm:block">Advanced Semantic Multi-Vector Evaluation</span>
                </div>
                
                <!-- System Status -->
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2" x-data="{ showDetails: false }">
                        <div class="flex items-center space-x-1 cursor-pointer" @click="showDetails = !showDetails">
                            <div class="w-3 h-3 rounded-full" :class="systemStatus.vespa_healthy ? 'bg-green-500' : 'bg-red-500'"></div>
                            <span class="text-sm text-gray-600">Vespa</span>
                            <i class="fas fa-chevron-down text-xs" :class="showDetails ? 'rotate-180' : ''"></i>
                        </div>
                        
                        <!-- Status Details -->
                        <div x-show="showDetails" x-cloak class="absolute top-16 right-4 bg-white shadow-lg rounded-lg p-4 z-50 border">
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span>Vespa Health:</span>
                                    <span :class="systemStatus.vespa_healthy ? 'text-green-600' : 'text-red-600'">
                                        <i :class="systemStatus.vespa_healthy ? 'fas fa-check' : 'fas fa-times'"></i>
                                        <span x-text="systemStatus.vespa_healthy ? 'Healthy' : 'Unhealthy'"></span>
                                    </span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Single Vector Docs:</span>
                                    <span x-text="systemStatus.document_counts.single_vector"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Multi-Vector Docs:</span>
                                    <span x-text="systemStatus.document_counts.multi_vector"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Embeddings:</span>
                                    <span :class="systemStatus.embeddings_loaded ? 'text-green-600' : 'text-red-600'">
                                        <i :class="systemStatus.embeddings_loaded ? 'fas fa-check' : 'fas fa-times'"></i>
                                        <span x-text="systemStatus.embeddings_loaded ? 'Loaded' : 'Missing'"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Search Section -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <div class="text-center mb-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-2">Compare Search Approaches</h2>
                <p class="text-gray-600">Test single-vector vs multi-vector search in real-time</p>
            </div>
            
            <!-- Search Form -->
            <form @submit.prevent="performSearch()" class="space-y-4">
                <div class="flex space-x-4">
                    <div class="flex-1">
                        <input 
                            type="text" 
                            x-model="query" 
                            placeholder="Enter your search query (e.g., 'manhattan project atomic bomb')"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            :disabled="loading"
                        >
                    </div>
                    <div class="w-32">
                        <select x-model="maxResults" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="3">3 results</option>
                            <option value="5">5 results</option>
                            <option value="10">10 results</option>
                        </select>
                    </div>
                    <button 
                        type="submit" 
                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
                        :disabled="loading || !query.trim()"
                    >
                        <i class="fas fa-search" x-show="!loading"></i>
                        <i class="fas fa-spinner fa-spin" x-show="loading"></i>
                        <span x-show="!loading">Search</span>
                        <span x-show="loading" class="loading-dots">Searching</span>
                    </button>
                </div>
            </form>
            
            <!-- Sample Queries -->
            <div class="mt-4">
                <p class="text-sm text-gray-600 mb-2">Try these sample queries:</p>
                <div class="flex flex-wrap gap-2">
                    <template x-for="sampleQuery in sampleQueries" :key="sampleQuery">
                        <button 
                            @click="query = sampleQuery; performSearch()"
                            class="text-xs px-3 py-1 bg-gray-100 text-gray-700 rounded-full hover:bg-gray-200 transition-colors"
                            :disabled="loading"
                            x-text="sampleQuery"
                        ></button>
                    </template>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div x-show="hasSearched" x-cloak>
            <!-- Performance Overview -->
            <div x-show="searchResults && searchResults.approaches" class="bg-white rounded-lg shadow-sm border p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Performance Comparison</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <template x-for="(approach, key) in searchResults.approaches" :key="key">
                        <div class="p-4 rounded-lg border-2" :style="`border-color: ${approach.color}20; background-color: ${approach.color}05`">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-900 text-sm" x-text="approach.name"></h4>
                                <div class="w-3 h-3 rounded-full" :style="`background-color: ${approach.color}`"></div>
                            </div>
                            <div class="space-y-1">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Time:</span>
                                    <span class="font-medium" x-text="`${approach.time_ms}ms`"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600">Results:</span>
                                    <span class="font-medium" x-text="approach.results.length"></span>
                                </div>
                                <div x-show="approach.results.length > 0" class="flex justify-between text-sm">
                                    <span class="text-gray-600">Top Score:</span>
                                    <span class="font-medium" x-text="approach.results[0]?.relevance || 'N/A'"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Detailed Results -->
            <div class="space-y-6">
                <template x-for="(approach, key) in searchResults.approaches" :key="key">
                    <div class="bg-white rounded-lg shadow-sm border">
                        <!-- Approach Header -->
                        <div class="p-6 border-b" :style="`border-color: ${approach.color}30`">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-4 h-4 rounded-full" :style="`background-color: ${approach.color}`"></div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900" x-text="approach.name"></h3>
                                        <p class="text-sm text-gray-600" x-text="approach.description"></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-semibold" x-text="`${approach.time_ms}ms`"></div>
                                    <div class="text-sm text-gray-600" x-text="`${approach.results.length} results`"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Results -->
                        <div class="p-6">
                            <div x-show="approach.error" class="p-4 bg-red-50 border border-red-200 rounded-lg mb-4">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-exclamation-triangle text-red-500"></i>
                                    <span class="text-red-700 font-medium">Error:</span>
                                </div>
                                <p class="text-red-600 text-sm mt-1" x-text="approach.error"></p>
                            </div>

                            <div x-show="!approach.error && approach.results.length === 0" class="text-center py-8 text-gray-500">
                                <i class="fas fa-search text-3xl mb-2"></i>
                                <p>No results found</p>
                            </div>

                            <div x-show="!approach.error && approach.results.length > 0" class="space-y-4">
                                <template x-for="(result, index) in approach.results" :key="result.id">
                                    <div class="result-card p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow">
                                        <div class="flex justify-between items-start mb-2">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-gray-900" x-text="result.title || 'Untitled Document'"></h4>
                                                <div class="flex items-center space-x-4 text-xs text-gray-500 mt-1">
                                                    <span>ID: <span x-text="result.id"></span></span>
                                                    <span>Score: <span x-text="result.relevance"></span></span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-sm font-medium text-blue-600" x-text="`#${index + 1}`"></div>
                                            </div>
                                        </div>
                                        <p class="text-gray-700 text-sm leading-relaxed" x-text="result.content"></p>
                                        <div x-show="result.url" class="mt-2">
                                            <a :href="result.url" class="text-blue-600 hover:text-blue-800 text-xs" x-text="result.url" target="_blank"></a>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- No Results State -->
        <div x-show="!hasSearched" class="text-center py-12">
            <i class="fas fa-search text-gray-300 text-6xl mb-4"></i>
            <h3 class="text-xl font-medium text-gray-900 mb-2">Ready to Search</h3>
            <p class="text-gray-600">Enter a query above to compare different search approaches</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    <strong>ASMuvera</strong> - Understanding Multi-Vector Search
                </div>
                <div class="flex space-x-4 text-sm text-gray-600">
                    <a href="#" class="hover:text-gray-900">Documentation</a>
                    <a href="#" class="hover:text-gray-900">GitHub</a>
                    <a href="#" class="hover:text-gray-900">About</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        function searchApp() {
            return {
                query: '',
                maxResults: 5,
                loading: false,
                hasSearched: false,
                searchResults: null,
                systemStatus: {
                    vespa_healthy: false,
                    document_counts: { single_vector: 0, multi_vector: 0 },
                    embeddings_loaded: false
                },
                sampleQueries: [
                    'manhattan project atomic bomb',
                    'nuclear physics research',
                    'scientific development',
                    'atomic energy applications',
                    'historical documents archives'
                ],

                async init() {
                    await this.loadSystemStatus();
                    await this.loadSampleQueries();
                },

                async loadSystemStatus() {
                    try {
                        const response = await fetch('/api/status');
                        const data = await response.json();
                        this.systemStatus = data;
                    } catch (error) {
                        console.error('Failed to load system status:', error);
                    }
                },

                async loadSampleQueries() {
                    try {
                        const response = await fetch('/api/sample-queries');
                        const data = await response.json();
                        this.sampleQueries = data.queries;
                    } catch (error) {
                        console.error('Failed to load sample queries:', error);
                    }
                },

                async performSearch() {
                    if (!this.query.trim() || this.loading) return;

                    this.loading = true;
                    this.searchResults = null;

                    try {
                        const response = await fetch('/api/search', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                query: this.query,
                                max_results: parseInt(this.maxResults)
                            }),
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const data = await response.json();
                        this.searchResults = data;
                        this.hasSearched = true;
                    } catch (error) {
                        console.error('Search failed:', error);
                        alert('Search failed: ' + error.message);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }
    </script>
</body>
</html>